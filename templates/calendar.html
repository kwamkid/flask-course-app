{% extends "base.html" %}
{% block title %}‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô{% endblock %}
{% block content %}

<div class="container-fluid mt-4" style="color: var(--font-color); padding: 20px;">
  <div class="card shadow-sm">
    <div class="card-header" style="background-color: var(--primary-color); color: white;">
      <h5 class="mb-0">üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</h5>
    </div>
    <div class="card-body" style="background-color: var(--light-color);">
      <div id="calendar"></div>
    </div>
  </div>
</div>

<style>
  #calendar {
    max-width: 100%;
    margin: 0 auto;
  }
</style>

<!-- ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ dayjs (‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏Å‡∏ß‡πà‡∏≤) -->
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/th.js"></script>
<script>
  dayjs.locale('th');
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    try {
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'th',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
        },
        events: {{ events | tojson | safe }},
        displayEventTime: false,
        eventDisplay: 'block',
        eventDidMount: function(info) {
  const event = info.event;
  const props = event.extendedProps;

  const className = `<div><strong>${event.title}</strong></div>`;
  const dateTime = `<div>${dayjs(event.start).format('dddd D MMM YYYY ‡πÄ‡∏ß‡∏•‡∏≤ HH:mm')}</div>`;
  const teacher = `<div>‡∏Ñ‡∏£‡∏π : ${props.teacher_name || '-'} ${props.teacher_phone || ''}</div>`;

  let studentsList = '<div>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô :</div>';
  if (props.student_names && props.student_names.length > 0) {
    studentsList += props.student_names.map((name, index) => `<div>${index + 1}. ${name}</div>`).join('');
  } else {
    studentsList += `<div>-</div>`;
  }

  const tooltipContent = `${className}${dateTime}${teacher}${studentsList}`;

  new bootstrap.Tooltip(info.el, {
    title: tooltipContent,
    placement: 'top',
    trigger: 'hover',
    container: 'body',
    html: true,
    customClass: 'fc-tooltip-custom'
  });
}
      });

      calendar.render();

    } catch (e) {
      console.error("‚ùå FullCalendar Error:", e);
    }
  });
</script>

<style>
  .fc-tooltip-custom .tooltip-inner {
    max-width: 300px;
    text-align: left;
    font-size: 14px;
    line-height: 1.4;
  }
</style>

{% endblock %}
